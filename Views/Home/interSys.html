<!DOCTYPE html>
<html>
	<head>
	    <!-- 编码格式 -->
	    <meta charset="UTF-8">
	    <title>上海银行</title>
	    <!-- 作者 -->
	    <meta name="author" content="author">
	    <!-- 网页描述 -->
	    <meta name="description" content="hello">
	    <!-- 关键字使用","分隔 -->
	    <meta name="keywords" content="a,b,c">
	    <!-- 禁止浏览器从本地机的缓存中调阅页面内容 -->
	    <meta http-equiv="Pragma" content="no-cache">
	    <!-- content的参数有all，none，index，noindex，follow，nofollow，默认是all -->
	    <meta name="robots" content="none">
	    <!-- 收藏图标 -->
	    <!-- <link rel="Shortcut Icon" href="favicon.ico"> -->
	    <!-- 网页不会被缓存 -->
	    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
	    <!-- 解决部分兼容性问题，如果安装了GCF，则使用GCF来渲染页面，如果未安装GCF，则使用最高版本的IE内核进行渲染。 -->
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <!-- 页面按原比例显示 -->
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <link rel="stylesheet" href="../../Styles/Plugin/bootstrap.min.css">
	    <link rel="stylesheet" href="../../Styles/Home/index.css">
	    <link rel="stylesheet" type="text/css" href="../../Styles/Home/ladda-themeless.min.css"/>
	    <link rel="stylesheet" type="text/css" href="../../Styles/Plugin/bootstrap-datetimepicker.min.css"/>
	    <script src="../../Scripts/plug/jquery-1.11.3.min.js"></script>
	 	<script src="../../Scripts/plug/bootstrap.min.js"></script>
		<script src="../../Scripts/home/public.js"></script>
		<script type="text/javascript" src="../../Scripts/home/spin.js"></script>
		<script type="text/javascript" src="../../Scripts/home/ladda.js"></script>
		<script type="text/javascript" src="../../Scripts/home/bootstrap-datetimepicker.min.js"></script>
	 	<script type="text/javascript" src="../../Scripts/home/bootstrap-datetimepicker.zh-CN.js"></script>
	    <!--[if lt IE 9]>
	       <script src="../../Scripts/home/html5shiv.min.js"></script>
	       <script src="../../Scripts/home/respond.js"></script>
	    <![endif]-->
	</head>
	<style>
		.upload-file .uf-button form {
            position: relative;
}

.upload-file .uf-button form input {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    filter: alpha(opacity=0);
    height: 100%;
    width: 100%;
}


	</style>
	<body>
	<div id="inforWrap" >
		<div class="table_top" >
			<div class="top_deal_item">
				<div class="left_deal">
					<input type="text" class="form-control" placeholder="请输入要搜索的内容">
					<button type="button" class="btn btn-primary" id="search" data-complete-text="加载中...">搜索
						</button>
				</div>
				<div class="right_deal">
					<button type="button" class="btn btn-primary" id="search" onclick="uploadTable(0)">导入固定资产</button>
					<button type="button" class="btn btn-primary" id="search" onclick="uploadTable(1)">导入低值易耗</button>
					<button type="button" class="btn btn-primary" id="search" onclick="uploadTable(2)">标签导入</button><!-- "-->
				</div>
			</div>
			<div class="table_header">
				<div class="header_content">
					<p>资产编号</p>
					<p>资产名称</p>
					<p>资产类型</p>
					<p>单位</p>
					<p>部门</p>
					<p>数量</p>
					<p>卡号</p>
					<p>是否闲置</p>
					<p>是否可用</p>
					<p>发卡时间</p>
				</div>
			</div>
			<div class="table_content">
	
			</div>
		</div>
		<div class="table-bot">
			<ul class="countNum">
				<li>已入库：<span class="num yrk">0</span>个 </li>
				<li>差异：<span class="num cy">0</span>个 </li>
				<li>正常：<span class="num zc">0</span>个 </li>
				<li>报废：<span class="num bf">0</span>个 </li>
				<li>已处置：<span class="num ycz">0</span>个 </li>
				<li class="edict unreg" onclick="lookUnReco()">查看未识别</li>
			</ul>
			
			
			<div class="table_header">
				<div class="header_content">
					<p>单位</p>
					<p>部门</p>
					<p>网点或科室</p>
					<p>财产分类</p>
					<p>财产编号</p>
					<p>财产名称</p>
					<p>型号</p>
					<p>是否闲置</p>
					<p class="unreg">操作</p>
				</div>
			</div>
			
			
			<div class="table_content">
	
			</div>
		</div>
		

	</div>
	<div class="alert alert-success alert-dismissable" style="width:400px;position: fixed;top: 50px;z-index: 99;left: 50%;margin-left: -200px;display: none;">
        <button type="button" class="close" data-dismiss="alert"
                aria-hidden="true">
            &times;
        </button>
        		操作成功。
    </div>
    <div class="alert alert-danger alert-dismissable" style="width:400px;position: fixed;top: 50px;z-index: 99;left: 50%;margin-left: -200px;display: none;">
        <button type="button" class="close" data-dismiss="alert"
                aria-hidden="true">
            &times;
        </button>
        	操作失败。
    </div>
	<div class="modal fade" id="myModal_upload" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						文件上传
						<!--<img style="height: 30px;width: 30px;" src="../../Image/bank/loading.gif"/>
						<span style="font-size: 14px;color: #3498db;">
							加载中...
						</span>-->
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						
						<div class="col-md-12">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="applicant" class="col-md-2 control-label">文件上传</label>
								    <div class="col-md-8 ">
								    	<input type="file" name="exampleInputFile" id="exampleInputFile" value="" />
								    </div>
								</div>
							</form>
						</div>
					</div>
					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary ladda-button" data-style="expand-right"  onclick="uploadFile(this)">
						<span class="ladda-label">确定</span>
					</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="myModal_card" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						发卡
						<span class="errorMsg" style="margin-left: 15px;color: red;font-size: 14px;">
							
						</span>
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
							<div class="col-md-12">
								<form class="form-horizontal">
									<div class="form-group">
									    <label for="begintime" class="col-md-2 control-label">
									    	卡号
									    	<span style="color: red;">*</span>
									    </label>
									    <div class="col-md-5">
									      <input type="text" class="form-control" id="rfcard" placeholder="卡号">
									    </div>
									</div>
								</form>
							</div>
							
						</div>
					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="uploadCard(this)">
						确定
					</button>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="myModal_dele" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						报废
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
							<div class="col-md-12">
								<form class="form-horizontal">
									<div class="form-group">
										<label class=" col-md-4 control-label">
										  确定进行资产报废？
										</label>
									</div>
								</form>
							</div>
						</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="deleteCard()">
						确定
					</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="myModal_unreg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" >
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						未识别卡号
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">
						确定
					</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="myModal_add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width: 800px;" onclick="hideMulCheck(this)">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						新增资产
						<span class="errorMsg" style="margin-left: 15px;color: red;font-size: 14px;">
							
						</span>
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">财产编号<span style="color: red;">*</span></label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="assecc_id" placeholder="财产编号">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">资产类型<span style="color: red;">*</span></label>
								    <div class="col-md-8"  style="position: relative;">
								      <!--<input type="text" class="form-control" id="type" placeholder="资产类型">-->
								    	<div  class="form-control"  id="ass_type" ></div>
								      
								        <div class="checkWrap" id="ass_type_check">
									      	<div class="item" checkId="0">
									      		 <span>固定资产</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									      	<div class="item" checkId="1">
									      		<span>易耗品</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									      	
									   </div>
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">卡号<span style="color: red;">*</span></label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="rfCard" placeholder="卡号">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">单位</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="unit" placeholder="单位">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">部门</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="department" placeholder="部门">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">网点或科室</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="branch" placeholder="网点或科室">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">财产分类</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="assetType" placeholder="财产分类">
								      
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">财产名称<span style="color: red;">*</span></label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="assetName" placeholder="财产名称">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">型号</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="model" placeholder="型号">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">数量</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="count" placeholder="数量">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">原值</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="orginalVal" placeholder="原值">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">启用日期</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="startUse" placeholder="启用日期">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">资产编号</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="assetId" placeholder="资产编号">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">保管人</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="keeper" placeholder="保管人">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">保管地点</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="keepPlace" placeholder="保管地点">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">采购申请单号</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="purchase" placeholder="采购申请单号">
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">备注</label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="remark" placeholder="备注">
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">是否闲置<span style="color: red;">*</span></label>
								    <div class="col-md-8"  style="position: relative;">
								    	<div  class="form-control"  id="isUsing" ></div>
								      <div class="checkWrap" id="isUse_type_check">
									      	<div class="item" checkId="1">
									      		 <span>是</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									      	<div class="item" checkId="0">
									      		<span>否</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									      	
									   </div>
								    </div>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<form class="form-horizontal">
								<div class="form-group">
								    <label for="contact" class="col-md-4 control-label">是否可用<span style="color: red;">*</span></label>
								    <div class="col-md-8" style="position: relative;">
								    	<div  class="form-control"  id="canUse" ></div>
								      <!--<input type="text" class="form-control" id="canUse" placeholder="是否可用">-->
								      <div class="checkWrap" id="canUse_type_check" >
									      	<div class="item" checkId="0">
									      		 <span>是</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									      	<div class="item" checkId="1">
									      		<span>否</span>
									      		<img src="../../Image/bank/gou.png"/>
									      	</div>
									   </div>
								    </div>
								</div>
							</form>
						</div>
						<div class="col-md-6">
							<!--<form class="form-horizontal">
								<div class="form-group">
								    <label for="contactPhone" class="col-md-4 control-label">是否闲置<span style="color: red;">*</span></label>
								    <div class="col-md-8">
								      <input type="text" class="form-control" id="contactPhone" placeholder="单位">
								    </div>
								</div>
							</form>-->
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="addUnregItem(this)">
						确定
					</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var fileType=0,ind=0,edictId=0,ycz=0;
	var AssetName,
	AssetType,
	Branch,
	Type ,
	CanUse,
	Count,
	Department,
	Id,
	IsUsing,
	AssetId,
	KeepPlace,
	Keeper,
	Model,
	OrginalVal,
	Purchase,
	Remark,
	StartUse,
	Unit,
	RfCard,
	RfTime;
	
	$(function(){	
		var locak= loadThisAdmin(8)
		if(locak!=1){
			return
		}
		var h=$(window).height();
		$(".table_content").css({height:(h-210)/2+'px'});
		loadInterData();
//		$("#myModal_add").modal("show");
		
		$("#ass_type").click(function(event){
			stopEvent(event)
			$(this).siblings(".checkWrap").show();
		})
		$("#ass_type_check .item").each(function(){
			$(this).click(function(){
				stopEvent(event)
				var id=$(this).attr("checkId");
				$(this).find("img").show();
				$(this).siblings().find("img").hide();
				Type=id;
				$("#ass_type").text($(this).find("span").text())
			})
		})
//		startUse
		$("#startUse").datetimepicker({
			format:"yyyy/mm/dd hh:ii",
			autoclose:true,
			language:  'zh-CN',
			minView:0,
			weekStart: 1,
			todayBtn : false,
		})
		$("#startUse").val(getTime());
		$("#canUse").click(function(event){
			stopEvent(event)
			$(this).siblings(".checkWrap").show();
		})
		$("#canUse_type_check .item").each(function(){
			$(this).click(function(){
				stopEvent(event)
				var id=$(this).attr("checkId");
				$(this).find("img").show();
				$(this).siblings().find("img").hide();
				CanUse=id;
				$("#canUse").text($(this).find("span").text())
			})
		})
		
		$("#isUsing").click(function(event){
			stopEvent(event)
			$(this).siblings(".checkWrap").show();
		})
		$("#isUse_type_check .item").each(function(){
			$(this).click(function(){
				stopEvent(event)
				var id=$(this).attr("checkId");
				$(this).find("img").show();
				$(this).siblings().find("img").hide();
				IsUsing=id;
				$("#isUsing").text($(this).find("span").text())
			})
		})
		$('.modal').on('show.bs.modal', function () {
			   $(".errorMsg").text("");
		})
		
	});
	function addUnregItem(dom){
		RfTime=getTime();
		var data={
			assetName:$("#assetName").val(),
			assetType:$("#assetType").val(),
			branch:$("#branch").val(),
			type :Type,
			canUse:CanUse,
			count:$("#count").val(),
			department:$("#department").val(),
			id:$("#assecc_id").val(),
			isUsing:IsUsing,
			assetId:$("#assetId").val(),
			keepPlace:$("#keepPlace").val(),
			keeper:$("#keeper").val(),
			model:$("#model").val(),
			orginalVal:$("#orginalVal").val(),
			purchase:$("#purchase").val(),
			remark:$("#remark").val(),
			startUse:$("#startUse").val(),
			unit:$("#unit").val(),
			rfCard:$("#rfCard").val(),
			rfTime:RfTime
		};
		if(!data.id){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("财产编号不能为空");
			return;
		}else if(!data.type){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("请选择资产类型");
			return;
		}else if(!data.rfCard){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("卡号不能为空");
			return;
		}else if(!data.isUsing){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("请选择是否闲置");
			return;
		}else if(!data.canUse){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("请选择是否可用");
			return;
		}
		
		JQajaxo("post", "/api/Event/add_assets_list", true,data, _success);
		function _success(res){
			var dat=res.HttpData.data;
			if(dat==1){
				ycz++;
				loadInterData()
				$("#myModal_add").modal("hide");
				$("#"+addId).remove();
			}else{
				$(".alert-danger").show()
			}
			setTimeout(function(){
				$(".alert").hide()
			},2000)
		}
	}
	function lookUnReco(){
		$("#myModal_unreg").modal("show")
	}
	function loadInterData(){
		JQajaxo("get", "/api/Event/get_asset_list", true,{}, _success);
		function _success(res){
			var dat=res.HttpData.data,lg=dat.length;
			$(".countNum .yrk").text(lg)
			$(".table_top .table_content").html("")
			paddingCount($(".table_top .table_content"),$(".table_top .header_content"),lg)
			for(var i=0;i<lg;i++){
				var value=dat[i];
				var html='<div class="table_line">'+
								'<p>'+value.id+'</p>'+
								'<p>'+value.assetName+'</p>'+
								'<p>'+value.assetType+'</p>'+
								'<p>'+value.unit+'</p>'+
								'<p>'+value.department+'</p>'+
								'<p>'+value.count+'</p>'+
								'<p>'+value.rfCard+'</p>'+
								'<p>'+returnIsuse(value.isUsing)+'</p>'+
								'<p>'+returnCanuse(value.canUse)+'</p>'+
								'<p>'+value.rfTime.replace("T"," ")+'</p>'+
						'</div>';
				$(".table_top .table_content").append(html)
			}
		}
	}
	function uploadTable(type){
		$("#myModal_upload").modal("show")
		fileType=type;
		if(type==2){
			
			$(".countNum .unreg").show();
			$(".header_content .unreg").text("状态");
		}else{
			$(".countNum .unreg").hide();
			$(".header_content .unreg").text("操作");
		}
	}
	function uploadFile(btn){
		var l=Ladda.create(document.querySelector(".ladda-button"))
		l.start();
		var files=document.getElementById("exampleInputFile").files;
		var formData=new FormData();
		var leng=files.length;
		var url;
		$(".ycz").text(0);
		if(fileType==2){
			for(var i=0;i<leng;i++){
				formData.append('data',files[0]);
				
			}
			url="http://10.7.1.192:9000/api/asset/skk"
//			url="http://168.7.1.192:9000/api/asset/skk";
			
		}else{
			for(var i=0;i<leng;i++){
				formData.append('data',files[0]);
				formData.append('type',fileType);
			}
			url="http://10.7.1.192:9000/api/asset/stt"
			
//			url="http://168.7.1.192:9000/api/asset/stt"
		}
		
		$.ajax({
			type:"post",
			url:url,
			async:true,
			data:formData,
			processData: false, // 不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理
		    contentType: false, // 不设置Content-type请求头
			success: function (dt) {
            	var dat=JSON.parse(dt)
            	$("#myModal_upload").modal("hide")
            	l.stop();
            	if(dat.Code==0){
            		if(fileType==2){
            			loadUnregHtml(dat.Message);
            		}else{
            			loadHtml(dat.Message)
            		}
					
					$(".alert-success").show();
            	}else{
            		$(".alert-danger").show()		            		
            	}
				setTimeout(function(){
					$(".alert").hide()
				},2000)
		    }
		});
	}
	function loadUnregHtml(str){
		var msg=JSON.parse(str)
		var lg=msg.uncheck.length;
		var unLg=msg.unrecognized.length;
		$(".countNum .cy").text(lg);
		var zc=0;
		paddingCount($(".table-bot .table_content"),$(".table-bot .header_content"),lg)
		$(".table-bot .table_content").html("");
		for(var i=0;i<lg;i++){
			var value=msg.uncheck[i];
			if(value.CanUse=="False"){
				zc++;
//				ht='<span class="edict" onclick="postCard('+i+',\''+value.ID+'\',\''+value.AssetId+'\',\''+value.AssetName+'\',\''+value.AssetType+'\',\''+value.Branch+'\',\''+value.CanUse+'\',\''+value.Count+'\',\''+value.Department+'\',\''+value.IsUsing+'\',\''+value.KeepPlace+'\',\''+value.Keeper+'\',\''+value.Mode+'\',\''+value.OrginalVal+'\',\''+value.Purchase+'\',\''+value.Remark+'\',\''+value.StartUse+'\',\''+value.Type+'\',\''+value.Unit+'\')">发卡</span>'
			}else{
//				ht='<span class="edict" onclick="postUnUse('+i+',\''+value.ID+'\')">报废</span>'
			}
			var html='<div id='+i+' class="table_line">'+
						'<p>'+value.Unit+'</p>'+
						'<p>'+value.Department+'</p>'+
						'<p>'+value.Branch+'</p>'+
						'<p>'+value.AssetType+'</p>'+
						'<p>'+value.ID+'</p>'+
						'<p>'+value.AssetName+'</p>'+
						'<p title="'+value.Mode+'">'+value.Mode+'</p>'+
						'<p>'+returnIsuse(value.IsUsing)+'</p>'+
						'<p><span class="edict">未扫描</span><span class="edict" onclick="deleteThis(this)">确认</span></p>'+
					'</div>';
			$(".table-bot .table_content").append(html);
		}
		$(".countNum .zc").text(zc);
		$(".countNum .bf").text(lg-zc);
		
		$("#myModal_unreg .modal-body .row").html("")
		for(var i=0;i<unLg;i++){
			var value=msg.unrecognized[i];
			var html='<div id="unregCard'+i+'" class="col-md-6 unregCard" style="cursor:pointer;" onclick="addNewAsset('+i+',\''+value+'\')">'+value+'</div>';
			$("#myModal_unreg .modal-body .row").append(html);
		}

	}
	function deleteThis(dom){
		$(dom).parents(".table_line").remove();
	}
	var addId;
	function addNewAsset(i,card){
		addId='unregCard'+i;
		$("#rfCard").val(card);
		$("#myModal_add").modal("show");
		$("#myModal_unreg").modal("hide")
	}
	function loadHtml(str){
		var msg=JSON.parse(str);
		var lg=msg.length;
		$(".countNum .cy").text(lg)
		var zc=0;
		$(".table-bot .table_content").html("");
		paddingCount($(".table-bot .table_content"),$(".table-bot .header_content"),lg)
		for(var i=0;i<lg;i++){
			var value=msg[i];
//			var str=JSON.stringify(value)
			if(value.CanUse=="0"){
				//可用
				zc++;
				ht='<span class="edict" onclick="postCard('+i+',\''+value.ID+'\',\''+value.AssetId+'\',\''+value.AssetName+'\',\''+value.AssetType+'\',\''+value.Branch+'\',\''+value.CanUse+'\',\''+value.Count+'\',\''+value.Department+'\',\''+value.IsUsing+'\',\''+value.KeepPlace+'\',\''+value.Keeper+'\',\''+value.Mode+'\',\''+value.OrginalVal+'\',\''+value.Purchase+'\',\''+value.Remark+'\',\''+value.StartUse+'\',\''+value.Type+'\',\''+value.Unit+'\')">发卡</span>'
			}else{
				ht='<span class="edict" onclick="postUnUse('+i+',\''+value.ID+'\')">报废</span>'
			}
			var html='<div id='+i+' class="table_line">'+
						'<p>'+value.Unit+'</p>'+
						'<p>'+value.Department+'</p>'+
						'<p>'+value.Branch+'</p>'+
						'<p>'+value.AssetType+'</p>'+
						'<p>'+value.ID+'</p>'+
						'<p>'+value.AssetName+'</p>'+
						'<p title="'+value.Mode+'">'+value.Mode+'</p>'+
						'<p>'+returnIsuse(value.IsUsing)+'</p>'+
						'<p>'+ht+'</p>'+
					'</div>';
			$(".table-bot .table_content").append(html);
		}
		$(".countNum .zc").text(zc);
		$(".countNum .bf").text(lg-zc);
	}
	function postUnUse(index,id){
		$("#myModal_dele").modal("show");
		ind=index;
		edictId=id;
		
	}
	function deleteCard(){
		JQajaxo("post", "/api/Event/upd_assets_canuse", true,{id:edictId}, _success);
		function _success(res){
			var dat=res.HttpData.data;
			$('#myModal_dele').modal('hide');
			if(dat==1){
				ycz++;
				$(".countNum .ycz").text(ycz);
				$(".alert-success").show();
				$(".table-bot #"+ind).remove();
				loadInterData()
			}else{
				$(".alert-danger").show()
			}
			setTimeout(function(){
				$(".alert").hide()
			},2000)
		}
	}
	function postCard(index,id,assetId,assetName,assetType,branch,canUse,count,department,isUsing,keepPlace,keeper,mode,orginalVal,purchase,remark,startUse,type,unit){
		AssetName=assetName;
		AssetType=assetType;
		Branch=branch;
		Type =type;
		CanUse=canUse;
		Count=count;
		Department=department;
		Id=id;
		IsUsing=isUsing;
		AssetId=assetId;
		KeepPlace=keepPlace;
		Keeper=keeper;
		Model=mode;
		OrginalVal=orginalVal;
		Purchase=purchase;
		Remark=remark;
		StartUse=startUse;
		Unit=unit;
		ind=index;
		$("#myModal_card").modal("show")
	}
	function  uploadCard(dom){
		RfCard=$("#rfcard").val();
		if(!RfCard){
			$(dom).parents(".modal-dialog").find(".errorMsg").text("卡号不能为空");
			return;
		}
		RfTime=getTime();
		var data={
			assetName:AssetName,
			assetType:AssetType,
			branch:Branch,
			type :Type,
			canUse:CanUse,
			count:Count,
			department:Department,
			id:Id,
			isUsing:IsUsing,
			assetId:AssetId,
			keepPlace:KeepPlace,
			keeper:Keeper,
			model:Model,
			orginalVal:OrginalVal,
			purchase:Purchase,
			remark:Remark,
			startUse:StartUse,
			unit:Unit,
			rfCard:RfCard,
			rfTime:RfTime
		}
		JQajaxo("post", "/api/Event/add_assets_list", true,data, _success);
		function _success(res){
			var dat=res.HttpData.data;
			$('#myModal_card').modal('hide');
			if(dat==1){
				ycz++;
				$(".countNum .ycz").text(ycz);
				$(".alert-success").show();
				$(".table-bot #"+ind).remove();
//				loadMeetingPlan();
				loadInterData()
			}else{
				$(".alert-danger").show()
			}
			setTimeout(function(){
				$(".alert").hide()
			},2000)
		}
	}
	function returnCanuse(bool){
		if(bool){
			return "不可用"
		}else{
			return "可用"
		}
	}
	function returnIsuse(bool){
		if(bool){
			return "闲置"
		}else{
			return "在用"
		}
	}
	function hideMulCheck(dom){
		$(dom).find('.checkWrap').hide()
		$(".typeNotice").hide()
//		$("#").css({borderColor:"#66afe9",outline:"0"});
	}
</script>
	
</html>
